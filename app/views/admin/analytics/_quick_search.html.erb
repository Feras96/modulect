<%# The quick search partial is used to display information about the number of quick searches, trending careers and any associated modules (e.g. most saved, most visited from quick search).

The main graph shows the number of quick searches in the time period. 
%>
<div class="row" >
   <div class="col-md-12  login-card header-card" style="">
      <div class="col-md-3 header-item">
         <div class="small-header"><i class="fa fa-search" aria-hidden="true"></i>&nbsp;&nbsp;<a class="help-tooltip" data-toggle="tooltip"  data-placement="right" title="The number of quick searches made in the time period">Quick Searches (<% if @time_period == "day" %><%= format_time_period(@time_period, false, true)%><% else %><%= format_time_period(@time_period, true, false)%><% end %>)</a>
         </div>
         <div class="main-figure">
            <%= all_data["number_of_quick_searches"] %>
         </div>
         <% if @time_period != "all_time" %>
         <% percentage_difference_total_quick_searches = 
            all_data["percentage_difference_number_of_quick_searches"]
            %>
         <div class="percentage-change <%= colour(percentage_difference_total_quick_searches)%>">
            <% if percentage_difference_total_quick_searches != 0 %>
            <i class="fa fa-caret-<%= indicator(percentage_difference_total_quick_searches)%>" aria-hidden="true"></i>
            <% end %> <%= percentage_difference_total_quick_searches %>% from previous <%= @time_period.titleize.downcase%>
         </div>
         <% end %>
      </div>
       <div class="col-md-3 header-item">
         <div class="small-header"><i class="fa fa-pencil-square-o" aria-hidden="true"></i>&nbsp;&nbsp;
            <a class="help-tooltip" data-toggle="tooltip"  data-placement="right" title="The tag which was most searched for">Most searched (<% if @time_period == "day" %><%= format_time_period(@time_period, false, true)%><% else %><%= format_time_period(@time_period, true, false)%><% end %>)</a>
         </div>
         <div class="main-figure">
            <%= get_top_module_name(get_top_size_check_analytics(all_data["clicked_tags"])) %>
         </div>      
         <div class="percentage-change">
            across any type of search
         </div>
      </div>
      <div class="col-md-3 header-item">
         <div class="small-header"><i class="fa fa-mouse-pointer" aria-hidden="true"></i>&nbsp;&nbsp;<a class="help-tooltip" data-toggle="tooltip"  data-placement="right" title="The most clicked module from search results">Most clicked module (<% if @time_period == "day" %><%= format_time_period(@time_period, false, true)%><% else %><%= format_time_period(@time_period, true, false)%><% end %>)</a>
         </div>
         <div class="main-figure">
         <% most_clicked_module =  get_top_module_code(get_top_size_check_analytics(all_data["visited_modules"])) %>
         </div>
        
         <div class="percentage-change">
            <%= get_top_module_name(most_clicked_module) %>
         </div>
      </div>
      <div class="col-md-3 header-item last">
         <div class="small-header"><i class="fa fa-star" aria-hidden="true"></i>&nbsp;&nbsp;<a class="help-tooltip" data-toggle="tooltip"  data-placement="left" title="The most saved module from results">Most saved module (<% if @time_period == "day" %><%= format_time_period(@time_period, false, true)%><% else %><%= format_time_period(@time_period, true, false)%><% end %>)</a>
         </div>
         <div class="main-figure">
         <% most_saved_module =  get_top_size_check_analytics(all_data["saved_modules"]) %>
            <%= get_top_module_code(most_saved_module) %>
         </div>
        
         <div class="percentage-change">
            <%= get_top_module_name(most_saved_module) %>
         </div>
      </div>
   </div>
</div>
<div class="row">
   <div class="col-md-12 login-card">
      <h4 class="small-header" style="margin-bottom:20px;">Number of quick searches <% if @time_period == "day" %><%= format_time_period(@time_period, false, true)%><% else %><%= format_time_period(@time_period, true, false)%><% end %></h4>
      <canvas id="quick-search-main-chart" width="400" height="120"></canvas>
      <script>
         var ctx = document.getElementById("quick-search-main-chart");
         
         var searchData = {
         labels : <%= get_list_of_time_periods(@time_period).to_json.html_safe %>,
         datasets : [
         {
         label : "# number of quick searches",
         data : <%= attach_search_log_data_to_time_period(get_search_lists(@department, "quick", 1, @time_period, Time.now), @time_period).to_json.html_safe %>,
         borderColor : "rgba(217,83,79,1)",
         backgroundColor : "rgba(217,83,79,0.1)"
         }
         
         ]
         };
         var mainSearchChart = new Chart(ctx, {
             type: 'line',
             data: searchData,
             options: {
                 scales: {
                     yAxes: [{
                         ticks: {
                             beginAtZero:true,
                             userCallback: function(label, index, labels) {
		                     // no decimals
		                     if (Math.floor(label) === label) {
		                         return label;
		                     }

		                 	},
                         }
                     }]
                 }
             }
         });
         
      </script>
   </div>
<% most_visited_modules = get_visited_modules(@department,@course,1,@time_period,Time.now,"most", 10) %>
   <div class="row">
      <div class="col-md-6" >
         <div class="col-md-12 login-card subox-card">
         <% if most_visited_modules.size != 0 %>
            <div class="side-right">
               <select class="selectpicker" name="per_page"  onchange="this.form.submit()">
                  <option value="500" >Area chart</option>
                  <option value="500" >Bar chart</option>
                  <option value="50" >Line chart</option>
                  <option value="250" >Pie chart</option>
                  <option value="10" selected="selected">Table</option>
               </select>
            </div>
            <% end %>
         
            <h4 class="small-header"><i class="fa fa-line-chart" aria-hidden="true"></i>&nbsp;&nbsp;<a class="help-tooltip" data-toggle="tooltip"  data-placement="right" title="Modules currently trending on Modulect">Trending modules</a></h4>
            <% if most_visited_modules.size == 0 %>
	            No data avaiable right now. Please try again later.
            <% else %>
	            <ol class="trending-list">
	            <% most_visited_modules.each do |uni_module, counter| %>
	            	<li><%= uni_module.code %> <%= uni_module.name %></li>
	            <% end %>
	            </ol>
	            <div class="expand-link">
	               <a data-toggle="tab" href="#modules" class="go-to-modules">Show more ></a>
	            </div>
            <% end %>
            	
         </div>
      </div>
<% most_clicked_tags = get_clicked_tags(@department,1,@time_period,Time.now,"most", 10) %>
       <div class="col-md-6" >
         <div class="col-md-12 login-card subox-card">
         <% if most_clicked_tags.size != 0 %>
            <div class="side-right">
               <select class="selectpicker" name="per_page"  onchange="this.form.submit()">
                  <option value="500" >Area chart</option>
                  <option value="500" >Bar chart</option>
                  <option value="50" >Line chart</option>
                  <option value="250" >Pie chart</option>
                  <option value="10" selected="selected">Table</option>
               </select>
            </div>
            <% end %>
         
            <h4 class="small-header"><i class="fa fa-line-chart" aria-hidden="true"></i>&nbsp;&nbsp;<a class="help-tooltip" data-toggle="tooltip"  data-placement="right" title="Tags currently trending on Modulect">Trending tags</a></h4>
            <% if most_clicked_tags.size == 0 %>
	            No data avaiable right now. Please try again later.
            <% else %>
	            <ol class="trending-list">
	            <% most_clicked_tags.each do |tag, counter| %>
	            	<li><%= tag.name %></li>
	            <% end %>
	            </ol>
	            <div class="expand-link">
	               <a data-toggle="tab" href="#tags" class="go-to-tags">Show more ></a>
	            </div>
            <% end %>
            	
         </div>
      </div>
   </div>
</div>