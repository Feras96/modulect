<% if request.query_parameters["search"].present?%>
<% provide(:title,  "\"" + request.query_parameters["search"] +"\"" + ' - Users') %>
<% else %>
<% provide(:title, 'Users') %>
<% end %>
<header class="header index-header-area">
   <h1 id="page-title"><%if current_user.user_level == "department_admin_access" %>
   <%= Department.find(current_user.department_id).name %>
   <% elsif request.query_parameters["dept"] && Department.exists?(@dept_filter_id) %>
   <%= Department.find(@dept_filter_id).name %>
   <% end %>Users</h1>
   <div class="header__actions">
      <div class="col-md-12">
         <% if current_user.user_level == "super_admin_access" %>
         <div class="btn-group">
            <button  style="height: 34px;" class="btn btn-drop btn-default navbar-btn dropdown-toggle-filter mobile-12-margin" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Department filter  <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
               <li> <%= link_to ("View All"), url_for( :sortby => @sort_by, :order => @order, :per_page => @per_page, :dept => 0  ), method: :get %></li>
               <% Department.all.sort_by{|department| department[:name]}.each do |department| %>
                  <li> <%= link_to (department.name.titleize), url_for( :sortby => @sort_by, :order => @order, :per_page => @per_page, :dept => department.id, :search => @search_query  ), method: :get %></li>
               <% end %>
            </ul>
            </div>
            <% end %>
         <% if @users.size > 0 %>
         <div class="btn-group">
            <button  style="height: 34px;" class="btn btn-drop btn-default navbar-btn dropdown-toggle mobile-12-margin" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Bulk Actions  <span class="caret"></span>
            </button>
            <ul class="dropdown-menu">
               <li> <a id="delete-all">(None available)</a>
               </li>
            </ul>
            </div>
         <% end %>
         <a class="button" href="<%= new_admin_user_path %>"><i aria-hidden='true' class='fa fa-plus'></i>&nbsp;&nbsp;New user</a>
      </div>
   </div>
</header>
<style>
   .table-responsive .checkbox{margin:0px;}
</style>
<% if @users.size > 0 %>
<div class="table-responsive">
   <table aria-labelledby="page-title" class="collection-data table">
      <thead>
         <tr class="table-header-fields">
            <td style="width:20px;">
               <div class="checkbox" style="margin:0px">
                  <input type="checkbox" name="check_all" id="check_all" value="true" class="toggle-bulk" /><label for="check_all"><span></span></label>
               </div>
            </td>
            <% sorting_columns = {"first_name" => "First Name", "last_name" => "Last Name", "email" => "Email", "user_level" => "User level"} %>
            <% if request.query_parameters["search"].present?%>
            <%= render partial: "admin/layouts/index_sorting", locals: {sorting_columns: sorting_columns, searching: true, per_page: @per_page, dept_filter_id: @dept_filter_id} %>
            <% else %>
            <%= render partial: "admin/layouts/index_sorting", locals: {sorting_columns: sorting_columns, searching: false, per_page: @per_page, dept_filter_id: @dept_filter_id} %>
            <% end %>
            <th class="cell-label cell-label--string cell-label--false" scope="col">Department</th>
            <th class="cell-label cell-label--string cell-label--false" scope="col">Available actions</th>
         </tr>
      </thead>
      <tbody>
         <%@users.each do |user| %>
         <tr class="table__row" data-url="<%= edit_admin_user_path(user) %>" role="link" tabindex="0">
            <td class="no-link checkboxes">
               <div class="checkbox" style="margin:0px">
                  <input type="checkbox" name="check_action[]" id="check_individual" value="<%= user.id %>" class="toggle-bulk" /><label for="check_individual"><span></span></label>
               </div>
              <% if user.user_level == "department_admin_access" && !user.department_id.present? %>
              <%= render partial: "admin/layouts/index_warning", locals: {message: "This Department admin has no department", destination: edit_admin_user_path(user)} %>
              <% end %>
               </div>
            </td>
            <td class="cell-data cell-data--string"><%= user.first_name %></td>
            <td class="cell-data cell-data--string"><%= user.last_name %></td>
            <td class="cell-data cell-data--string"><%= user.email %></td>
            <td class="cell-data cell-data--string"><%= user.user_level.titleize.chomp('Access') %></td>
            <td class="cell-data cell-data--string">
            <% if user.user_level == "super_admin_access" %>
            n/a
            <%elsif user.department_id.present? %>
            	<%= Department.find(user.department_id).name %>
            	<% else %>
-
            	<% end %>
            </td>
            <td class="no-link">
               <div class="col-md-3"><a class="action-edit" href="<%= edit_admin_user_path(user) %>"><i class="fa fa-pencil" aria-hidden="true" ></i>&nbsp;&nbspEdit</a></div>
              
            <% if current_user.id != user.id %> <div class="col-md-3"><%= link_to "<i class='fa fa-trash' aria-hidden='true'></i> Delete".html_safe, admin_user_path(user), method: :delete,
                  data: { confirm: "Are you sure you want to delete this user?" } , class: "table__action--destroy" %></div>
            <% end %>
            </td>
         </tr>
         <%end %>
      </tbody>
   </table>
   <%= paginate @users %>
</div>
<%= render partial: "admin/layouts/per_page", locals: {sort_by: @sort_by, order: @order, per_page: @per_page, search_query: @search_query, dept_filter_id: @dept_filter_id} %>
<% elsif request.query_parameters["search"].present?%>
<h4 style="margin-bottom:30px;">Unfortunately, we couldn't find any users related to your search query.</h4>
<% else %>
<h4 style="margin-bottom:30px;">No users found</h4>
<% end %>