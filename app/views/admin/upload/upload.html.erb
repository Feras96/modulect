<style>
  @media (min-width: 990px) {
    .row {
      display: -webkit-box;
      display: -webkit-flex;
      display: -ms-flexbox;
      display: flex;
      flex-wrap: wrap;
      width: 100%;
    }

    .row > [class*='col-'] {
      display: flex;
      flex-direction: column;
    }

    .login-card {
      height: 100%;
      text-align: center;
    }
  }
</style>

<h1 style="font-size: 1.728em; margin-bottom: 30px;">Upload Data</h1>

<div id="upload-instructions" class="col-lg-12 login-card">
  <h3 style="margin-bottom: 20px;">Begin Upload</h3>
  <% if current_user.user_level == 'super_admin_access' %>
    <h4>As a super admin, you can upload <strong>Modules, Courses, Departments and Faculties</strong> via a CSV file.</h4>
  <% else %>
      <h4>As a Department admin, you can upload <strong>Modules and Courses</strong> via a CSV file.</h4>
  <% end %>
  <h4>To begin uploading simply click the button below:</h4>
  <div class="form-entry text-center" style="margin-top: 20px;">
    <a id="upload-start" class="btn btn-lg">Start ></a>
  </div>
</div>

<div class="row" style="margin: 0;">
  <div id="upload-step-1" class="col-lg-12 login-card" style="margin-bottom: 20px; display: none;">
    <h3>Step 1: Select the resource to upload</h3>
    <form>
      <div class="form-entry text-center" style="margin-top: 20px;">
        <select id="upload-resource" class="form-control" style="font-size: 14px; padding: 6px 12px">
          <option value="uni_modules">Modules</option>
          <option value="courses">Courses</option>
          <% if current_user.user_level == 'super_admin_access' %>
            <option value="departments">Departments</option>
            <option value="faculties">Faculties</option>
          <% end %>
        </select>
      </div>
      <div class="form-entry text-center" style="margin-top: 20px;">
        <a id="upload-1-next" class="btn btn-md">Next</a>
      </div>
    </form>
  </div>

  <div id="upload-step-2" class="col-lg-12 login-card" style="margin-bottom: 20px; display: none;">
    <h3>Step 2: Download CSV template</h3>
    <div class="form-entry text-center" style="margin-top: 20px;">
      <%= button_to 'Download', admin_download_path(resource_choice: 'default'), class: 'btn btn-md', id: 'upload-2-next' %>
    </div>
  </div>

  <div id="upload-help" class="col-lg-12 login-card" style="margin-bottom: 20px; display: none;">
    <a id="upload-help-toggle">Click here for help on how to fill out the CSV</a>
    <div class="text-center" style="margin-top: 20px; display: none;">

    </div>
  </div>

  <div id="upload-step-3" class="col-lg-12 login-card" style="margin-bottom: 20px; display: none;">
    <h3>Step 3: Upload data</h3>
    <div class="form-entry text-center" style="margin-top: 20px;">
      <%= form_tag('/admin/upload/upload_csv', method: 'post', multipart: true) do %>
          <%= file_field_tag :csv_upload, id: 'csv-upload', onchange: 'validate_file_extension(this.value);', required: true, accept: 'text/csv' %>
          <%= submit_tag 'Upload', id: 'upload-3-next', class: 'btn btn-md' %>
      <% end %>
    </div>
  </div>
</div>

<script>
    // Validate if file extension of uploaded file is .csv
    function validate_file_extension(fileName) {
        var allowed_extension = "csv";
        // Retrieve file name of uploaded file
        var file_extension = fileName.split(".").pop();

        if (file_extension == allowed_extension) {
            // Show the upload button if file ext. is correct
            $("#upload-3-next").show();
            return true;
        }

        // Hide the show button if file ext. is incorrect
        $("#upload-3-next").hide();
        // Delete currently selected file
        $("#csv-upload").val(null);
        alert("File must be a CSV (.csv). Ensure the uploaded file meets " +
            "this requirement before continuing.");
        return false;
    }

    $(function () {
        $("#upload-start").on("click", function () {
            $("#upload-step-1").show();
            $("#upload-instructions").hide();
        });

        $("#upload-1-next").on("click", function () {
            $("#upload-step-2").show();
        });

        $("#upload-2-next").on("click", function () {
            $("#upload-step-3").show();
            $("#upload-help").show();
            var resource_name = $("select#upload-resource").val();
            $("form.button_to").attr("action", "/admin/download?resource_choice=" + resource_name)
        });

        $("select#upload-resource").change(function () {
            $("#upload-step-2").hide();
            $("#upload-step-3").hide();
        });
    });
</script>
